<html>

<head>
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script>
	$(function(){
	  $("#header").load("header.html");
	});
	</script>
</head>

<body style="background-color:#D8D8D8">
	<div id="header"></div>



	<div class="container" style="float:left">
	  <div class="row">
	  	<div class="col-md-5">
		  <label class="radio-inline"><input type="radio" name="optradio" id="scripts">Scripts</label>
		  <label class="radio-inline"><input type="radio" name="optradio" id="sets">Sets</label>
	  	</div>
	  	<div class="col-md-4">
		  <button type="button" class="btn btn-default btn-lg" style="width:100%" id="refreshSets">
  			<span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> Refresh Sets
		  </button>
	  	</div>
	  </div>

	  <div class="row">
	    <div class="col-md-5">
	      <select class="form-control" id="list"></select>
	    </div>
	    <div class="col-md-4">
	      <button type="button" class="btn btn-default btn-lg" style="width:100%;margin-top:10" id="refresh">
  			<span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> Refresh Scripts
		  </button>
	    </div>
	  </div>

	  <div class="row">
	  	<div class="col-md-5">
	      <input type="text" id="args" style="width:100%" placeholder="Arguments">
	    </div>
	  	<div class="col-md-4">
	  	  <button type="button" class="btn btn-default btn-lg" style="margin-top:10;width:100%" id="run">
  			<span class="glyphicon glyphicon-play" aria-hidden="true"></span> Run
		  </button>
	  	</div>
	  </div>

	  <div class="row">
	  	<div class="col-md-5">
	  		<div class="panel panel-default">
			  <div class="panel-heading">
			    <h3 class="panel-title">Output</h3>
			  </div>
			  <div class="panel-body" style="height:300px;background-color:#000000;color:lime;" id="output">
			  </div>
			</div>
	  	</div>
	  	<div class="col-md-5">
	  		<h2 id="scrst">Script status: <span></span></h2>
	  	</div>
	  </div>
	</div>


	<script>
		$('document').ready(function(){
			RefreshScripts();

			$("#refresh").click(function(){
				RefreshScripts()
			});

			$("#refreshSets").click(function(){
				RefreshSets()
			});

			$("#scripts").click(function(){
				RefreshScripts()
			});

			$("#sets").click(function(){
				RefreshSets()
				var set = $("#list option:selected").text()
				$.ajax({
					url: "service/sets?set=" + set,
					type: "get",
					dataType: "json",
					success: function(scripts){
						$("#panelTitle").html(set)
						$("#panelBody").html("")
						$.each(scripts, function(i, val){
							$("#panelBody").append("<p>" + val + "</p>")
						});
					}
				});
			});

			$("#run").click(function(){
				var name = $("#list option:selected").text();
				var args = $("#args").val().split(" ")
				var req = 'run/' + name + "?"
				args.forEach(function(arg) {
    				req = req + arg + "&"
				});
				console.log(req)
				if ($('#scripts').is(":checked")) {
					$.ajax({
						url: req,
						type: 'get',
						dataType: 'json',
						success: function(uuid){
							var id = uuid
							$("#output").html("")
						}
					});
				}
				else {
					console.log("sent sets req");
					$.ajax({
						url: 'service/sets?set=' + name,
						type: 'get',
						dataType: 'json',
						success: function(setl){
							console.log(setl)
							$.each(setl, function(i, val){
								while($("#serverstatus").text() == "Server Status: working"){
									console.log("working")
								}
								console.log("sent run req");
								$.ajax({
									url: 'run/' + val,
									type: 'get',
									dataType: 'json',
									success: function(uuid){
										var id = uuid
										intervalId = setInterval(function(){ GetOutput(name, uuid) }, 100);
									}
								});
							});
						}
					});
				}
			});
		});

		function RefreshScripts(){
			$.ajax({
				url: 'service/list',
				type: 'get',
				dataType: 'json',
				success: function(list){
					$("#list").html("")
					$.each(list, function(i, val){
						$("#list").append("<option value=" + val + ">" + val + "</option>")
					});
				}
			});

			$('#scripts').prop('checked',true);
		}

		function RefreshSets(){
			$.ajax({
				url: "service/sets",
				type: "get",
				dataType: "json",
				success: function(list){
					$("#list").html("")
					$.each(list, function(i, val){
						$("#list").append("<option value=" + val + ">" + val + "</option>")
					});
				}
			});

			$('#sets').prop('checked',true);
		}

		function GetOutput(name, uuid){
			$.ajax({
				url: 'log/' + name + '?uuid=' + uuid,
				type: 'get',
				dataType: 'json',
				success: function(out) {
					$("#output").html($("#output").text() + out)
				}
			});
		}
	</script>
</body>
</html>